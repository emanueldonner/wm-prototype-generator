/* @copyright Stadt Wien - Wiener Melange v2 */
import{s as t,y as e}from"../../lit-element-a22611a3.js";import{_stringToObject as s}from"../misc/utils.js";class i extends t{static properties={url:{type:String,reflect:!0},dataset:{type:String},pagination:{type:String},itemsperpage:{type:Number,reflect:!0},_itemsPerSet:{type:Number,reflect:!0},_results:{type:Array}};get _resultsContainer(){return this.querySelector('[slot="results"]')??null}get _content(){return this._resultsContainer?.querySelector("[data-fetch-content]")??null}get _attributes(){return this._resultsContainer?.querySelectorAll("[data-fetch-attributes]")??null}get _template(){return this.querySelector("template")??null}constructor(){super(),this.url="",this.dataset=void 0,this._results="",this.itemsperpage=5,this._itemsPerSet=this.itemsperpage,this.pagination="none"}createRenderRoot(){return this}updated(t){t.has("itemsperpage")&&(this._itemsPerSet=this.itemsperpage),t.has("url")&&this._fetchData()}_fetchData(){fetch(this.url).then((t=>t.json())).then((t=>{this._results=this.dataset?t[this.dataset]:t,this._displayData(!0),this.dispatchEvent(new CustomEvent("fetched",{detail:this._results.length,bubbles:!0,composed:!0}))}))}_displayData(){if(this._content){this._content.innerHTML="";for(let t=0;t<this._itemsPerSet;t++){const e=this._results[t];if(e){const t=this._template.content.cloneNode(!0).children[0],i=t.querySelectorAll("[data-fetch-field]");for(let t=0;t<i.length;t++){const r=i[t];r.textContent=s(r.dataset.fetchField,e)}this._replaceAttributes(t.querySelectorAll("[data-fetch-attribute]"),e),this._content.appendChild(t)}}}else this._attributes&&this._replaceAttributes(this._attributes,this._results[0])}_replaceAttributes(t,e){for(let i=0;i<t.length;i++){const r=t[i];for(const t in r.dataset)if(-1!==t.indexOf("fetchAttribute")&&r.dataset[t]){const i=r.dataset[t].split(":");r.setAttribute(i[0],s(i[1],e))}}}_loadMore(){this._itemsPerSet=this._itemsPerSet+this.itemsperpage,this._displayData()}connectedCallback(){super.connectedCallback()}render(){return e`
      <wm-stack vertical gap="xs">
        <div><slot name="results"></slot></div>
        <div><slot name="template"></slot></div>
        ${"button"===this.pagination&&this._itemsPerSet<this._results.length?e`
          <wm-button @click="${this._loadMore}">
            <button>Mehr laden</button>
          </wm-button>`:""}
      </wm-stack>
    `}}customElements.define("wm-fetch",i);const r="wm-fetch";export{i as Fetch,r as tagName};
