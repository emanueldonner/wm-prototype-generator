/* @copyright Stadt Wien - Wiener Melange v2 */
import{s as t,y as e}from"../../lit-element-a22611a3.js";import{_stringToObject as s}from"../misc/utils.js";class r extends t{static properties={url:{type:String},dataset:{type:String},pagination:{type:String},itemsPerPage:{type:Number},_itemsPerSet:{type:Number},_results:{type:Array}};get _resultsContainer(){return this.querySelector('[slot="results"]')??null}get _content(){return this._resultsContainer?.querySelector("[data-fetch-content]")??null}get _attributes(){return this._resultsContainer?.querySelectorAll("[data-fetch-attributes]")??null}get _template(){return this.querySelector("template")??null}constructor(){super(),this.url="",this.dataset="",this._results="",this.itemsPerPage=5,this._itemsPerSet=this.itemsPerPage,this.pagination="none"}createRenderRoot(){return this}_fetchData(){console.log(this.querySelectorAll('[slot="]')),fetch(this.url).then((t=>t.json())).then((t=>{console.log(t),this._results=this.dataset?t[this.dataset]:t,this._displayData(!0)}))}_displayData(t=!1){if(this._content){this._content.innerHTML="";for(let t=0;t<this._itemsPerSet;t++){const e=this._results[t];if(e){const t=this._template.content.cloneNode(!0).children[0],r=t.querySelectorAll("[data-fetch-field]");for(let t=0;t<r.length;t++){const i=r[t];i.textContent=s(i.dataset.fetchField,e)}this._replaceAttributes(t.querySelectorAll("[data-fetch-attribute]"),e),this._content.appendChild(t)}}}else this._attributes&&this._replaceAttributes(this._attributes,this._results[0])}_replaceAttributes(t,e){for(let r=0;r<t.length;r++){const i=t[r];for(const t in i.dataset)if(-1!==t.indexOf("fetchAttribute")&&i.dataset[t]){const r=i.dataset[t].split(":");i.setAttribute(r[0],s(r[1],e))}}}_loadMore(){this._itemsPerSet=this._itemsPerSet+this.itemsPerPage,this._displayData()}connectedCallback(){super.connectedCallback(),this._fetchData()}render(){return e`
      <slot name="results"></slot>
      <slot name="template"></slot>
      ${"button"===this.pagination&&this._itemsPerSet<this._results.length?e`<wm-button @click="${this._loadMore}"><button>Load more</button></wm-button>`:""}
    `}}customElements.define("wm-fetch",r);const i="wm-fetch";export{r as Fetch,i as tagName};
